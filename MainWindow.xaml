<Window x:Class="WPF_Budgetplanerare_GOhman.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:WPF_Budgetplanerare_GOhman" xmlns:scm="clr-namespace:System.ComponentModel;assembly=WindowsBase"
        mc:Ignorable="d"
        Title="MainWindow" Height="768" Width="1024"
        ResizeMode="NoResize">
    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVis"/>

        <!--TODO: Move to global.xaml later. Just for testing now-->
        <Style TargetType="{x:Type ListView}">
            <Setter Property="Background" Value="#DEE2E6"/>
            <Setter Property="BorderBrush" Value="White"/>
            <Setter Property="BorderThickness" Value="2"/>
        </Style>
        <Style TargetType="{x:Type TabControl}">
            <Setter Property="Background" Value="#ADB5BD"/>
        </Style>
        <Style TargetType="{x:Type GridViewColumnHeader}">
            <Setter Property="Background" Value="#DEE2E6" />
            <Setter Property="Foreground" Value="#212529" />
            <Setter Property="FontWeight" Value="Bold" />
        </Style>

        <Style TargetType="{x:Type DataGrid}">
            <Setter Property="Background" Value="#DEE2E6"/>
            <Setter Property="BorderBrush" Value="White"/>
            <Setter Property="BorderThickness" Value="2"/>



        </Style>
        <Style TargetType="{x:Type DataGridCell}">
        </Style>
        <Style TargetType="{x:Type DataGridColumnHeader}">
            <Setter Property="Background" Value="#DEE2E6"/>
            <Setter Property="Margin" Value="10 10 10 10"/>
            <Setter Property="FontWeight" Value="Bold" />
            <Setter Property="MinWidth" Value="60"/>
            <Setter Property="Foreground" Value="#212529"/>

        </Style>
        <Style TargetType="{x:Type DataGridRow}">
            <Setter Property="Background" Value="#DEE2E6"/>
        </Style>
        <!--<Style TargetType="{x:Type Expander}">
            <Setter Property="BorderBrush" Value="Gray"/>
            <Setter Property="BorderThickness" Value="1"/>
        </Style>-->
        <Style TargetType="{x:Type Calendar}">
            <Setter Property="Background" Value="#DEE2E6"/>
        </Style>
        <Style TargetType="{x:Type Label}">
            <Setter Property="FontWeight" Value="Bold"/>
        </Style>
        <Style TargetType="{x:Type TextBox}">
            <Setter Property="Padding" Value="5"/>
        </Style>
    </Window.Resources>
    <TabControl TabStripPlacement="Left"
                SelectedIndex="{Binding SelectedTabIndex}">

        <TabControl.Resources>
            <Style TargetType="TabPanel">
                <Setter Property="VerticalAlignment" Value="Center"/>

            </Style>
            <Style TargetType="TabItem">
                <Setter Property="Height" Value="50"/>
                <!--<Setter Property="Width" Value="40"/>-->
            </Style>
        </TabControl.Resources>
        <TabItem Header="MainWindow">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="50"></RowDefinition>
                    <RowDefinition Height="Auto"></RowDefinition>
                    <RowDefinition></RowDefinition>
                    <RowDefinition></RowDefinition>
                    <RowDefinition></RowDefinition>
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="50"></ColumnDefinition>

                    <ColumnDefinition></ColumnDefinition>
                    <ColumnDefinition Width="250"></ColumnDefinition>
                    <ColumnDefinition></ColumnDefinition>
                    <ColumnDefinition></ColumnDefinition>
                </Grid.ColumnDefinitions>

                <StackPanel VerticalAlignment="Center" Grid.Column="3" Grid.Row="1" Grid.ColumnSpan="2"
                            HorizontalAlignment="Center">
                    <Button Style="{StaticResource btnPrimary}" 
                            Command="{Binding AddCommand}">
                        Lägg till ny transaktion
                    </Button>
                    <Button  Style="{StaticResource btnDanger}"
                            Command="{Binding DeleteCommand}">
                        Ta bort transaktion
                    </Button>
                </StackPanel>
                <Calendar x:Name="datePicker" 
                          Grid.Column="1" 
                          Grid.Row="0" 
                          Grid.ColumnSpan="2" 
                          HorizontalAlignment="Center" 
                          Margin="0,10,0,0" 
                          VerticalAlignment="Center" 
                          DisplayDate="{Binding SelectedDate, Mode=TwoWay}" />


                <ListView Grid.Row="1" 
                          Grid.RowSpan="3" 
                          Grid.Column="1"
                          Grid.ColumnSpan="2"  
                          SelectedItem="{Binding SelectedBudgetTransaction}" 
                          d:ItemsSource="{d:SampleData ItemCount=5}"
                          >

                    <ListView.Resources>
                        <CollectionViewSource x:Key="GroupedTransactions"
                                              Source="{Binding BudgetTransactions}">
                            <CollectionViewSource.GroupDescriptions>
                                <PropertyGroupDescription PropertyName="Category.Name"/>
                            </CollectionViewSource.GroupDescriptions>
                            <CollectionViewSource.SortDescriptions>
                                <scm:SortDescription PropertyName="Category.Name" Direction="Ascending"/>
                            </CollectionViewSource.SortDescriptions>
                        </CollectionViewSource>
                    </ListView.Resources>

                    <ListView.ItemsSource>
                        <Binding Source="{StaticResource GroupedTransactions}"/>
                    </ListView.ItemsSource>
                    <ListView.View>
                        <GridView>
                            <GridViewColumn Header="Anteckning" Width="120"
                                            DisplayMemberBinding="{Binding Note}"/>
                            <GridViewColumn Header="Belopp" Width="100"
                                    DisplayMemberBinding="{Binding Amount}"/>
                            <GridViewColumn Header="Typ" Width="60"
                                    DisplayMemberBinding="{Binding TransactionType}"/>
                            <GridViewColumn Header="Datum" Width="100"
                                    DisplayMemberBinding="{Binding EffectiveDate, StringFormat={}{0:yyyy-MM-dd}}"/>
                        </GridView>
                    </ListView.View>
                    <ListView.GroupStyle>
                        <GroupStyle>
                            <GroupStyle.HeaderTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding Name}" 
                                               FontWeight="Bold" 
                                               FontSize="14" 
                                               Margin="0,5,0,0"
                                               Background="#6C757D"
                                               Foreground="#E9ECEF"
                                               Padding="4"/>
                                </DataTemplate>
                            </GroupStyle.HeaderTemplate>
                        </GroupStyle>
                    </ListView.GroupStyle>
                </ListView>

                <Expander Grid.Row="2" 
                          Grid.Column="3" 
                          Grid.ColumnSpan="2"
                          Grid.RowSpan="2"
                          ExpandDirection="Left"
                          IsExpanded="{Binding IsExpanderExpanded, Mode=TwoWay}"
                           Template="{DynamicResource ExpanderOverride}"
                          >

                    <StackPanel Orientation="Vertical">
                        <StackPanel.Resources>
                            <Style TargetType="Label">
                                <Setter Property="Width" Value="100"/>
                                <Setter Property="Margin" Value="5 0"/>
                                <Setter Property="DockPanel.Dock" Value="Left"/>
                                <Setter Property="HorizontalContentAlignment" Value="Right"/>
                                <Setter Property="FontWeight" Value="Bold"/>
                            </Style>
                        </StackPanel.Resources>
                        <DockPanel>

                            <Label Content="Datum: " Target="{Binding ElementName=effectiveDate}"/>
                            <DatePicker x:Name="effectiveDate" Margin="5"
                                    Text="{Binding Path=EditableBudgetTransaction.EffectiveDate, Mode=TwoWay, StringFormat={}{0:yyyy-MM-dd}}"/>
                        </DockPanel>

                        <DockPanel>
                            <Label Content="Belopp: " Target="{Binding ElementName=amount}"/>
                            <TextBox x:Name="amount" Margin="5"
                     Text="{Binding Path=EditableBudgetTransaction.Amount, Mode=TwoWay}"/>
                        </DockPanel>
                        <DockPanel>
                            <Label Content="Anteckning: " Target="{Binding ElementName=note}"/>
                            <TextBox x:Name="note" Margin="5"
                     Text="{Binding Path=EditableBudgetTransaction.Note, Mode=TwoWay}"/>
                        </DockPanel>
                        <DockPanel>
                            <Label Content="Kategori: " Target="{Binding ElementName=category}"/>
                            <ComboBox x:Name="category" Margin="5"
                      Grid.Column="3" 
                      RenderTransformOrigin="1.087,-0.255"
                      ItemsSource="{Binding Categories}"
                      DisplayMemberPath="Name"
                      SelectedItem="{Binding Path=EditableBudgetTransaction.Category, Mode=TwoWay}"/>
                        </DockPanel>
                        <DockPanel>
                            <Label Content="Inkomst/Utgift: " Target="{Binding ElementName=category}"/>

                            <ComboBox ItemsSource="{Binding TransactionTypes}"
                      SelectedItem="{Binding Path=EditableBudgetTransaction.TransactionType, Mode=TwoWay}"
                      Margin="5"/>
                        </DockPanel>
                        <Separator Margin="5"/>

                        <CheckBox Margin="5"
                                  Content="Återkommande Transaktion?"
                                  IsChecked="{Binding Path=EditableBudgetTransaction.IsRecurring, Mode=TwoWay}"
                                  IsEnabled="{Binding Path=SelectedBudgetTransaction.IsNotRecurrence}"/>

                        <Expander IsExpanded="{Binding EditableBudgetTransaction.IsRecurring}"  
                                  IsEnabled="{Binding Path=SelectedBudgetTransaction.IsNotRecurrence}"
                                  Template="{DynamicResource ExpanderOverride}">
                            <StackPanel>
                                <DockPanel>
                                    <Label Content="Intervall: " />
                                    <ComboBox Margin="5"
                                              ItemsSource="{Binding RecurrenceOptions}"
                                              SelectedItem="{Binding Path=EditableBudgetTransaction.RecurringRule.Frequency, Mode=TwoWay}"/>
                                </DockPanel>
                                <DockPanel>
                                    <Label Content="Slutdatum? :"/>
                                    <DatePicker Margin="5" SelectedDate="{Binding Path=EditableBudgetTransaction.RecurringRule.EndDate, Mode=TwoWay}"></DatePicker>
                                </DockPanel>
                            </StackPanel>

                        </Expander>
                        <Label Width="auto"
                               HorizontalAlignment="Center"
                               Visibility="{Binding SelectedBudgetTransaction.IsRecurrence, Converter={StaticResource BoolToVis}}"
                               Foreground="DarkRed">
                            Detta kommer ändra alla instanser av denna transaktion
                        </Label>
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                            <Button Style="{StaticResource btnPrimary}"
                                    Command="{Binding SaveCommand}">Spara</Button>
                            <Button Style="{StaticResource btnDanger}"
                                Command="{Binding AbortCommand}">Avbryt</Button>
                        </StackPanel>
                    </StackPanel>
                </Expander>

                <StackPanel Orientation="Horizontal" 
                            Grid.Column="1" 
                            Grid.Row="4"
                            Grid.ColumnSpan="2"
                            Height="30"
                            HorizontalAlignment="Left"
                            VerticalAlignment="Top">
                    <DockPanel>

                        <Label>Summa månad (SEK):</Label>
                        <Label Content="{Binding MonthlyTotals, Mode=OneWay}"/>
                    </DockPanel>
                </StackPanel>
            </Grid>
        </TabItem>
        <TabItem Header="Månadsprognos">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="150"></ColumnDefinition>
                    <ColumnDefinition></ColumnDefinition>
                    <ColumnDefinition></ColumnDefinition>
                    <ColumnDefinition Width="150"></ColumnDefinition>
                </Grid.ColumnDefinitions>

                <Grid.RowDefinitions>
                    <RowDefinition Height="80"></RowDefinition>
                    <RowDefinition Height="50"></RowDefinition>
                    <RowDefinition></RowDefinition>
                    <RowDefinition></RowDefinition>
                    <RowDefinition></RowDefinition>
                    <RowDefinition Height="80"></RowDefinition>

                </Grid.RowDefinitions>
                <DockPanel Grid.Column="1" Grid.Row="1">
                    <Label Content="Från datum"></Label>
                    <Calendar HorizontalAlignment="Left" VerticalAlignment="Center" DisplayDate="{Binding ForecastFromDate, Mode=TwoWay}" />
                </DockPanel>
                <DockPanel Grid.Column="2" Grid.Row="1">
                    <Label Content="Till datum"></Label>
                    <Calendar HorizontalAlignment="Left" VerticalAlignment="Center" DisplayDate="{Binding ForecastToDate, Mode=TwoWay}" />
                </DockPanel>
                <Button Grid.Column="1" 
                        Style="{StaticResource btnPrimary}"
                        Grid.ColumnSpan="2"
                        HorizontalAlignment="Center"
                        VerticalAlignment="Top"
                        Grid.Row="4" Command="{Binding GenerateForecastCommand}"
                        Padding="30 10">Generera</Button>

                <DataGrid Grid.Column="1" 
                          Grid.ColumnSpan="2"
                          Grid.Row="2"
                          Margin="10 0 0 0"
                          Grid.RowSpan="2" 
                          ItemsSource="{Binding MonthlyForecastTotals}" 
                          IsReadOnly="True" 
                          AutoGenerateColumns="False"
                          d:ItemsSource="{d:SampleData ItemCount=5}"
                          RowHeight="30"
                          RowHeaderWidth="0"
                          HeadersVisibility="Column"
                          GridLinesVisibility="Horizontal"
                    >
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Månad" Binding="{Binding Month, StringFormat={}{0:MMM yyyy}, Mode=OneWay}" />
                        <DataGridTextColumn Header="Inkomster (SEK)" Binding="{Binding TotalIncomes, Mode=OneWay}"/>
                        <DataGridTextColumn Header="Utgifter (SEK)" Binding="{Binding TotalExpenses, Mode=OneWay}"/>
                        <DataGridTextColumn Header="Totalt (SEK)" Binding="{Binding Sum, Mode=OneWay}"/>

                    </DataGrid.Columns>
                </DataGrid>

            </Grid>
        </TabItem>
        <TabItem Header="Användarinställningar">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition></ColumnDefinition>
                    <ColumnDefinition></ColumnDefinition>
                    <ColumnDefinition></ColumnDefinition>
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition></RowDefinition>
                    <RowDefinition></RowDefinition>
                    <RowDefinition></RowDefinition>
                </Grid.RowDefinitions>

                <StackPanel Grid.Column="1" Grid.Row="1">
                    <Label>Årsinkomst</Label>
                    <TextBox Text="{Binding YearlyIncome}"/>
                    <Label>Arbetstid per år</Label>
                    <TextBox Text="{Binding WorkhoursPerYear}"/>
                    <Button Style="{StaticResource btnPrimary}" Command="{Binding CalculateBudgetCommand}">Beräkna budget</Button>
                </StackPanel>
            </Grid>
        </TabItem>
    </TabControl>
</Window>
